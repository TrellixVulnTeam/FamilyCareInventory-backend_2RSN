{"ast":null,"code":"import { ElMessage, ElMessageBox } from 'element-plus';\nimport { onMounted, ref } from \"vue\";\nimport { addBuy } from '@/api/addBuy';\nimport { myBuys } from \"@/api/myBuy\";\nimport { buyDetail } from \"@/api/buyDetail\";\nimport { deleteBuy } from \"@/api/deleteBuy\";\nimport { updateShipTime } from \"@/api/updateShipTime\";\nexport default {\n  setup(__props, {\n    expose\n  }) {\n    expose();\n    const rules = ref({\n      note: [{\n        required: true,\n        message: '请输入',\n        trigger: 'blur'\n      }],\n      deposit: [{\n        required: true,\n        message: '请输入客户名称',\n        trigger: 'blur'\n      }],\n      buy_time: [{\n        required: true,\n        message: '请输入成交金额',\n        trigger: 'blur'\n      }]\n    });\n    onMounted(async () => {\n      const y = await myBuys(localStorage.getItem('token'));\n      buysData.value = y;\n    });\n    const purchaseForm = ref({\n      products: [{\n        product_name: '',\n        product_version: '',\n        quantity: '',\n        price: ''\n      }],\n      note: '',\n      deposit: '',\n      buy_time: ''\n    });\n\n    const addbuy = async () => {\n      addBuy(purchaseForm.value, localStorage.getItem('token')).then(() => {\n        ElMessageBox.alert('提交成功！', {\n          confirmButtonText: 'OK',\n          callback: () => {\n            setTimeout(initBuyData, 1);\n            setTimeout(resetPurchaseForm, 1);\n            ElMessage({\n              type: 'info',\n              message: '已更新列表'\n            });\n          }\n        });\n      }).catch(err => {\n        alert(err);\n      });\n    };\n\n    const addProduct = async () => {\n      purchaseForm.value.products.push({\n        product_name: '',\n        product_version: '',\n        quantity: '',\n        price: '',\n        key: Date.now()\n      });\n    };\n\n    const removeProduct = product => {\n      var index = purchaseForm.value.products.indexOf(product);\n\n      if (index !== -1) {\n        purchaseForm.value.products.splice(index, 1);\n      }\n    };\n\n    const resetPurchaseForm = async () => {\n      purchaseForm.value = {\n        products: [{\n          product_name: '',\n          product_version: '',\n          quantity: '',\n          price: ''\n        }],\n        note: '',\n        deposit: '',\n        buy_time: ''\n      };\n    };\n\n    const buysData = ref([]);\n    const showDialog = ref(false);\n    const dialogData = ref([]);\n\n    const handleDetail = async row => {\n      // eslint-disable-next-line\n      const x = await buyDetail(row.buyId, localStorage.getItem('token'));\n      showDialog.value = true;\n      dialogData.value = x;\n    };\n\n    const initBuyData = async () => {\n      buysData.value = [];\n      buysData.value = await myBuys(localStorage.getItem('token'));\n    };\n\n    const handleDelete = async row => {\n      deleteBuy({\n        token: localStorage.getItem('token'),\n        buyId: row.buyId\n      });\n      ElMessage({\n        type: 'info',\n        message: '已删除'\n      });\n      setTimeout(initBuyData, 1);\n    };\n\n    const shiptimeValue = ref([]);\n\n    const handleUpdateShipTime = async row => {\n      const body = {\n        token: localStorage.getItem('token'),\n        ship_time: shiptimeValue.value[row],\n        buyId: row\n      };\n      updateShipTime(body);\n      ElMessage({\n        type: 'info',\n        message: 'rated, reload data'\n      });\n      setTimeout(initBuyData, 1);\n      shiptimeValue.value = [];\n    };\n\n    const focusOnNextItem = nextItemId => {\n      var nextItem = document.getElementById(nextItemId);\n      nextItem.focus();\n    };\n\n    const __returned__ = {\n      rules,\n      purchaseForm,\n      addbuy,\n      addProduct,\n      removeProduct,\n      resetPurchaseForm,\n      buysData,\n      showDialog,\n      dialogData,\n      handleDetail,\n      initBuyData,\n      handleDelete,\n      shiptimeValue,\n      handleUpdateShipTime,\n      focusOnNextItem,\n      ElMessage,\n      ElMessageBox,\n      onMounted,\n      ref,\n      addBuy,\n      myBuys,\n      buyDetail,\n      deleteBuy,\n      updateShipTime\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n\n};","map":{"version":3,"mappings":"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","names":["ElMessage","ElMessageBox","onMounted","ref","addBuy","myBuys","buyDetail","deleteBuy","updateShipTime","rules","note","required","message","trigger","deposit","buy_time","y","localStorage","getItem","buysData","value","purchaseForm","products","product_name","product_version","quantity","price","addbuy","then","alert","confirmButtonText","callback","setTimeout","initBuyData","resetPurchaseForm","type","catch","err","addProduct","push","key","Date","now","removeProduct","product","index","indexOf","splice","showDialog","dialogData","handleDetail","row","x","buyId","handleDelete","token","shiptimeValue","handleUpdateShipTime","body","ship_time","focusOnNextItem","nextItemId","nextItem","document","getElementById","focus"],"sources":["/Users/alzhong/Personal/Projects/FamilyCareInventory/frontend/src/views/MainView/PurchaseView/PurchaseView.vue"],"sourcesContent":["<template>\n  <div class=\"page-title\">\n    <h1>添加采购</h1>\n    <hr style=\"width:50%;text-align:left;margin-left:0\">\n  </div>\n  <div class=\"list-form\">\n    <el-form :model=\"purchaseForm\" ref=\"form\" label-width=\"100px\" :rules=\"rules\">\n      <el-form-item prop=\"note\" label=\"采购抬头\" @keyup.enter=\"focusOnNextItem('deposit')\">\n        <el-input v-model=\"purchaseForm.note\" class=\"item-input\"></el-input>\n      </el-form-item>\n      <el-form-item prop=\"deposit\" label=\"采购订金\">\n        <el-input v-model=\"purchaseForm.deposit\" class=\"item-input\" @keyup.enter=\"focusOnNextItem('bt')\" id=\"deposit\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"采购日期\" prop=\"buy_time\">\n      <el-date-picker\n          type=\"date\" placeholder=\"选择日期\" v-model=\"purchaseForm.buy_time\" id=\"bt\">\n      </el-date-picker>\n      </el-form-item>\n      <el-form-item v-for=\"(product, index) in purchaseForm.products\"\n                    :label=\"'商品' + index\"\n                    :key=\"product.key\"\n                    :prop=\"'商品.' + index + '.product_name'\">\n        <el-col :span=\"3\">\n        <el-input v-model=\"product.product_name\" placeholder=\"品名\" style=\"width: 100%;\"></el-input>\n        </el-col>\n        &nbsp;&nbsp;&nbsp;\n          <el-col :span=\"3\">\n          <el-input v-model=\"product.product_version\" placeholder=\"型号\" style=\"width: 100%;\"></el-input>\n          </el-col>\n        &nbsp;&nbsp;&nbsp;\n        <el-col :span=\"3\">\n          <el-input v-model=\"product.quantity\" placeholder=\"数量\" style=\"width: 100%;\"></el-input>\n        </el-col>\n        &nbsp;&nbsp;&nbsp;\n        <el-col :span=\"3\">\n          <el-input v-model=\"product.price\" placeholder=\"单价\" style=\"width: 100%;\"></el-input>\n        </el-col>\n        &nbsp;&nbsp;&nbsp;\n        <el-button @click.prevent=\"removeProduct(product)\">删除</el-button>\n        </el-form-item>\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"addbuy\" class=\"item-button\">提交</el-button>\n        <el-button @click=\"addProduct\" class=\"item-button\">新增商品</el-button>\n        <el-button @click=\"resetPurchaseForm\" class=\"item-button\">重置</el-button>\n      </el-form-item>\n    </el-form>\n  </div>\n  <br/>\n  <br/>\n  <br/>\n  <div class=\"page-title\">\n    <h1>采购列表</h1>\n    <hr style=\"width:50%;text-align:left;margin-left:0\">\n  </div>\n\n  <div class=\"items-container\">\n    <el-table :data=\"buysData\" style=\"width: 100%\" table-layout: auto>\n      <el-table-column prop=\"note\" label=\"采购抬头\"/>\n      <el-table-column prop=\"deposit\" label=\"采购订金\"/>\n      <el-table-column prop=\"buy_time\" label=\"采购日期\"/>\n      <el-table-column prop=\"ship-time\" label=\"发运时间\">\n        <template #default=\"scope\">\n        <el-date-picker v-model=\"shiptimeValue[scope.row.buyId]\" @change=\"handleUpdateShipTime(scope.row.buyId)\"\n            type=\"date\" placeholder=\"选择日期\" v-if=\"!scope.row.ship_time\">\n        </el-date-picker>\n          <p v-if=\"scope.row.ship_time\">{{ scope.row.ship_time }}</p>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"商品列表\">\n        <template #default=\"{ row }\">\n          <el-button type=\"text\" size=\"small\" @click=\"handleDetail(row)\"\n          >Detail\n          </el-button\n          >\n        </template>\n      </el-table-column>\n      <el-table-column fixed=\"right\" label=\"操作\">\n        <template #default=\"{ row }\">\n      <el-select v-model=\"buysData[row.buyId]\" class=\"m-2\" placeholder=\"Select\" size=\"small\"\n                 @change=\"handleDelete(row)\">\n        <el-option label=\"删除\" value=0></el-option>\n      </el-select>\n        </template>\n      </el-table-column>\n    </el-table>\n    <el-dialog\n        v-model=\"showDialog\"\n    >\n      <el-table :data=\"dialogData\" style=\"width: 100%\" table-layout: auto>\n        <el-table-column prop=\"product_name\" label=\"品名\"/>\n        <el-table-column prop=\"product_version\" label=\"型号\"/>\n        <el-table-column prop=\"quantity\" label=\"数量\"/>\n        <el-table-column prop=\"price\" label=\"单价\"/>\n      </el-table>\n    </el-dialog>\n  </div>\n</template>\n\n<script setup>\nimport { ElMessage, ElMessageBox } from 'element-plus'\nimport {onMounted, ref} from \"vue\";\nimport { addBuy } from '@/api/addBuy'\nimport {myBuys} from \"@/api/myBuy\"\nimport {buyDetail} from \"@/api/buyDetail\";\nimport {deleteBuy} from \"@/api/deleteBuy\"\nimport {updateShipTime} from \"@/api/updateShipTime\"\n\nconst rules = ref({\n  note: [\n    {\n      required: true,\n      message: '请输入',\n      trigger: 'blur'\n    }\n  ],\n  deposit: [\n    {\n      required: true,\n      message: '请输入客户名称',\n      trigger: 'blur'\n    }\n  ],\n  buy_time: [\n    {\n      required: true,\n      message: '请输入成交金额',\n      trigger: 'blur'\n    }\n  ]\n})\n\nonMounted(async () => {\n  const y = await myBuys(localStorage.getItem('token'))\n  buysData.value = y\n})\n\nconst purchaseForm = ref({\n  products: [{\n    product_name: '',\n    product_version: '',\n    quantity: '',\n    price: ''\n  }],\n  note: '',\n  deposit: '',\n  buy_time: ''\n})\n\nconst addbuy = async () => {\n  addBuy(purchaseForm.value, localStorage.getItem('token')).then(() => {\n    ElMessageBox.alert('提交成功！', {\n      confirmButtonText: 'OK',\n      callback: () => {\n        setTimeout(initBuyData, 1)\n        setTimeout(resetPurchaseForm, 1)\n        ElMessage({\n          type: 'info',\n          message: '已更新列表'\n        })\n      }\n    })\n  }).catch((err) => {\n    alert(err)\n  })\n}\n\nconst addProduct = async() =>{\n  purchaseForm.value.products.push({\n    product_name: '',\n    product_version: '',\n    quantity: '',\n    price: '',\n    key: Date.now()\n  })}\n\nconst removeProduct = (product) => {\n  var index = purchaseForm.value.products.indexOf(product)\n  if (index !== -1) {\n    purchaseForm.value.products.splice(index, 1)\n  }\n}\n\nconst resetPurchaseForm = async() =>{\n  purchaseForm.value = {\n    products: [{\n      product_name: '',\n      product_version: '',\n      quantity: '',\n      price: ''\n    }],\n    note: '',\n    deposit: '',\n    buy_time: ''\n  }\n}\n\nconst buysData = ref([])\nconst showDialog = ref(false)\nconst dialogData = ref([])\nconst handleDetail = async (row) => {\n  // eslint-disable-next-line\n  const x = await buyDetail(row.buyId, localStorage.getItem('token'))\n  showDialog.value = true\n  dialogData.value = x\n}\nconst initBuyData = async () => {\n  buysData.value = []\n  buysData.value = await myBuys(localStorage.getItem('token'))\n}\nconst handleDelete = async (row) => {\n  deleteBuy({\n    token: localStorage.getItem('token'),\n    buyId: row.buyId,\n  })\n  ElMessage({\n    type: 'info',\n    message: '已删除'\n  })\n  setTimeout(initBuyData, 1)\n}\nconst shiptimeValue = ref([])\nconst handleUpdateShipTime = async (row) => {\n  const body = {\n    token: localStorage.getItem('token'),\n    ship_time: shiptimeValue.value[row],\n    buyId: row\n  }\n  updateShipTime(body)\n  ElMessage({\n    type: 'info',\n    message: 'rated, reload data'\n  })\n  setTimeout(initBuyData, 1)\n  shiptimeValue.value = []\n}\n\nconst focusOnNextItem = (nextItemId) => {\n  var nextItem = document.getElementById(nextItemId)\n  nextItem.focus()\n}\n</script>\n\n<style scoped lang=\"scss\">\n\n.list-form {\n  margin-left: 350px;\n}\n\n.page-title {\n  font-size: 20px;\n  text-align: left;\n  margin-left: 300px;\n  margin-bottom: 20px;\n}\n\n.item-input {\n  width: 400px;\n}\n\n.item-button {\n  margin-left: 10px;\n  margin-top: 20px;\n}\n\n.items-container {\n  margin-left: 300px;\n  width: 1000px;\n}\n\n.page-title {\n  font-size: 20px;\n  text-align: left;\n  margin-left: 300px;\n  margin-bottom: 20px;\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}