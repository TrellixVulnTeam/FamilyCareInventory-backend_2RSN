{"ast":null,"code":"import { ElMessage, ElMessageBox } from 'element-plus';\nimport { onMounted, ref } from \"vue\";\nimport { myOrders } from \"@/api/myOrder\";\nimport { orderDetail } from \"@/api/orderDetail\";\nimport { deleteOrder } from \"@/api/deleteOrder\";\nimport { addOrder } from '@/api/addOrder';\nexport default {\n  setup(__props, {\n    expose\n  }) {\n    expose();\n    const rules = ref({\n      note: [{\n        required: true,\n        message: '请输入成交抬头',\n        trigger: 'blur'\n      }],\n      customer_name: [{\n        required: true,\n        message: '请输入客户名称',\n        trigger: 'blur'\n      }],\n      total: [{\n        required: true,\n        message: '请输入成交金额',\n        trigger: 'blur'\n      }],\n      trans_time: [{\n        required: true,\n        message: '请输入成交日期',\n        trigger: 'blur'\n      }],\n      flag: [{\n        required: true,\n        message: '请输入成交方式',\n        trigger: 'blur'\n      }],\n      method: [{\n        required: true,\n        message: '请输入支付方式',\n        trigger: 'blur'\n      }]\n    });\n    onMounted(async () => {\n      const y = await myOrders(localStorage.getItem('token'));\n      ordersData.value = y;\n    });\n    const orderForm = ref({\n      products: [{\n        product_name: '',\n        product_version: '',\n        quantity: '',\n        price: ''\n      }],\n      note: '',\n      trans_time: '',\n      flag: '',\n      total: '',\n      customer_name: '',\n      method: ''\n    });\n\n    const addorder = async () => {\n      var legacy_total = 0;\n\n      for (let product of orderForm.value.products) {\n        legacy_total += product.price * product.quantity;\n      }\n\n      if (eval(legacy_total) !== eval(orderForm.value.total)) {\n        ElMessage({\n          type: 'error',\n          message: '总成交额与所有商品销售额总和不符，请重新检查'\n        });\n        return;\n      }\n\n      addOrder(orderForm.value, localStorage.getItem('token')).then(() => {\n        ElMessageBox.alert('提交成功！', {\n          confirmButtonText: 'OK',\n          callback: () => {\n            setTimeout(initOrderData, 1);\n            setTimeout(resetOrderForm, 1);\n            ElMessage({\n              type: 'info',\n              message: '已更新列表'\n            });\n          }\n        });\n      }).catch(err => {\n        alert(err);\n      });\n    };\n\n    const addOrderProduct = async () => {\n      orderForm.value.products.push({\n        product_name: '',\n        product_version: '',\n        quantity: '',\n        price: '',\n        key: Date.now()\n      });\n    };\n\n    const removeOrderProduct = product => {\n      var index = orderForm.value.products.indexOf(product);\n\n      if (index !== -1) {\n        orderForm.value.products.splice(index, 1);\n      }\n    };\n\n    const resetOrderForm = async () => {\n      orderForm.value = {\n        products: [{\n          product_name: '',\n          product_version: '',\n          quantity: '',\n          price: ''\n        }],\n        note: '',\n        trans_time: '',\n        flag: '',\n        total: '',\n        customer_name: '',\n        method: ''\n      };\n    };\n\n    const ordersData = ref([]);\n    const showDialog = ref(false);\n    const dialogData = ref([]);\n\n    const handleDetail = async row => {\n      // eslint-disable-next-line\n      const x = await orderDetail(row.orderId, localStorage.getItem('token'));\n      showDialog.value = true;\n      dialogData.value = x;\n    };\n\n    const initOrderData = async () => {\n      ordersData.value = [];\n      ordersData.value = await myOrders(localStorage.getItem('token'));\n    };\n\n    const handleDelete = async row => {\n      deleteOrder({\n        token: localStorage.getItem('token'),\n        orderId: row.orderId\n      });\n      ElMessage({\n        type: 'info',\n        message: '已删除'\n      });\n      setTimeout(initOrderData, 1);\n    };\n\n    const focusOnNextItem = nextItemId => {\n      var nextItem = document.getElementById(nextItemId);\n      nextItem.focus();\n    };\n\n    const __returned__ = {\n      rules,\n      orderForm,\n      addorder,\n      addOrderProduct,\n      removeOrderProduct,\n      resetOrderForm,\n      ordersData,\n      showDialog,\n      dialogData,\n      handleDetail,\n      initOrderData,\n      handleDelete,\n      focusOnNextItem,\n      ElMessage,\n      ElMessageBox,\n      onMounted,\n      ref,\n      myOrders,\n      orderDetail,\n      deleteOrder,\n      addOrder\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n\n};","map":{"version":3,"mappings":"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","names":["ElMessage","ElMessageBox","onMounted","ref","myOrders","orderDetail","deleteOrder","addOrder","rules","note","required","message","trigger","customer_name","total","trans_time","flag","method","y","localStorage","getItem","ordersData","value","orderForm","products","product_name","product_version","quantity","price","addorder","legacy_total","product","eval","type","then","alert","confirmButtonText","callback","setTimeout","initOrderData","resetOrderForm","catch","err","addOrderProduct","push","key","Date","now","removeOrderProduct","index","indexOf","splice","showDialog","dialogData","handleDetail","row","x","orderId","handleDelete","token","focusOnNextItem","nextItemId","nextItem","document","getElementById","focus"],"sources":["/Users/alzhong/Personal/Projects/FamilyCareInventory/frontend/src/views/MainView/OrderView/OrderView.vue"],"sourcesContent":["<template>\n  <div class=\"page-title\">\n    <h1>添加成交</h1>\n    <hr style=\"width:50%;text-align:left;margin-left:0\">\n  </div>\n  <div class=\"list-form\">\n    <el-form :model=\"orderForm\" ref=\"form\" label-width=\"100px\" :rules=\"rules\">\n      <el-form-item prop=\"note\" label=\"成交抬头\">\n        <el-input v-model=\"orderForm.note\" class=\"item-input\" @keyup.enter=\"focusOnNextItem('cn')\"></el-input>\n      </el-form-item>\n      <el-form-item prop=\"customer_name\" label=\"客户名称\">\n        <el-input v-model=\"orderForm.customer_name\" class=\"item-input\" @keyup.enter=\"focusOnNextItem('total')\" id=\"cn\"></el-input>\n      </el-form-item>\n      <el-form-item prop=\"total\" label=\"成交额\">\n        <el-input v-model=\"orderForm.total\" class=\"item-input\" @keyup.enter=\"focusOnNextItem('tt')\" id=\"total\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"成交日期\" prop=\"trans_time\">\n        <el-date-picker\n            type=\"date\" placeholder=\"选择日期\" v-model=\"orderForm.trans_time\" id=\"tt\">\n        </el-date-picker>\n      </el-form-item>\n      <el-form-item label=\"成交方式\" prop=\"flag\" required>\n        <el-radio-group v-model=\"orderForm.flag\">\n          <el-radio label=\"offline\">线下</el-radio>\n          <el-radio label=\"online\">线上</el-radio>\n        </el-radio-group>\n      </el-form-item>\n      <el-form-item label=\"支付方式\" prop=\"method\" required>\n        <el-radio-group v-model=\"orderForm.method\">\n          <el-radio label=\"cash\">现金</el-radio>\n          <el-radio label=\"etransfer\">电子支付</el-radio>\n        </el-radio-group>\n      </el-form-item>\n      <el-form-item v-for=\"(product, index) in orderForm.products\"\n                    :label=\"'商品' + index\"\n                    :key=\"product.key\"\n                    :prop=\"'商品.' + index + '.product_name'\">\n        <el-col :span=\"5\">\n          <el-input v-model=\"product.product_name\" placeholder=\"品名\" style=\"width: 100%;\"></el-input>\n        </el-col>\n        &nbsp;&nbsp;&nbsp;\n        <el-col :span=\"5\">\n          <el-input v-model=\"product.product_version\" placeholder=\"型号\" style=\"width: 100%;\"></el-input>\n        </el-col>\n        &nbsp;&nbsp;&nbsp;\n        <el-col :span=\"5\">\n          <el-input v-model=\"product.quantity\" placeholder=\"数量\" style=\"width: 100%;\"></el-input>\n        </el-col>\n        &nbsp;&nbsp;&nbsp;\n        <el-col :span=\"5\">\n          <el-input v-model=\"product.price\" placeholder=\"单价\" style=\"width: 100%;\"></el-input>\n        </el-col>\n        &nbsp;&nbsp;&nbsp;\n        <el-button @click.prevent=\"removeOrderProduct(product)\">删除</el-button>\n      </el-form-item>\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"addorder\" class=\"item-button\">提交</el-button>\n        <el-button @click=\"addOrderProduct\" class=\"item-button\">新增商品</el-button>\n        <el-button @click=\"resetOrderForm\" class=\"item-button\">重置</el-button>\n      </el-form-item>\n    </el-form>\n  </div>\n  <br/>\n  <br/>\n  <br/>\n  <div class=\"page-title\">\n    <h1>成交列表</h1>\n    <hr style=\"width:50%;text-align:left;margin-left:0\">\n  </div>\n\n  <div class=\"items-container\">\n    <el-table :data=\"ordersData\" style=\"width: 100%\" table-layout: auto>\n      <el-table-column prop=\"note\" label=\"成交抬头\"/>\n      <el-table-column prop=\"customer_name\" label=\"客户名称\"/>\n      <el-table-column prop=\"total\" label=\"成交额\"/>\n      <el-table-column prop=\"trans_time\" label=\"成交日期\"/>\n      <el-table-column prop=\"flag\" label=\"成交方式\"/>\n      <el-table-column prop=\"method\" label=\"支付方式\"/>\n      <el-table-column label=\"商品列表\">\n        <template #default=\"{ row }\">\n          <el-button type=\"text\" size=\"small\" @click=\"handleDetail(row)\"\n          >Detail\n          </el-button\n          >\n        </template>\n      </el-table-column>\n      <el-table-column fixed=\"right\" label=\"操作\">\n        <template #default=\"{ row }\">\n          <el-select v-model=\"ordersData[row.orderId]\" class=\"m-2\" placeholder=\"Select\" size=\"small\"\n                     @change=\"handleDelete(row)\">\n            <el-option label=\"删除\" value=0></el-option>\n          </el-select>\n        </template>\n      </el-table-column>\n    </el-table>\n    <el-dialog\n        v-model=\"showDialog\"\n        title=\"商品列表\"\n    >\n      <el-table :data=\"dialogData\" style=\"width: 100%\" table-layout: auto>\n        <el-table-column prop=\"product_name\" label=\"品名\"/>\n        <el-table-column prop=\"product_version\" label=\"型号\"/>\n        <el-table-column prop=\"quantity\" label=\"数量\"/>\n        <el-table-column prop=\"price\" label=\"单价\"/>\n      </el-table>\n    </el-dialog>\n  </div>\n</template>\n\n<script setup>\nimport { ElMessage, ElMessageBox } from 'element-plus'\nimport {onMounted, ref} from \"vue\";\nimport {myOrders} from \"@/api/myOrder\"\nimport {orderDetail} from \"@/api/orderDetail\";\nimport {deleteOrder} from \"@/api/deleteOrder\"\nimport { addOrder } from '@/api/addOrder'\n\nconst rules = ref({\n  note: [\n    {\n      required: true,\n      message: '请输入成交抬头',\n      trigger: 'blur'\n    }\n  ],\n  customer_name: [\n    {\n      required: true,\n      message: '请输入客户名称',\n      trigger: 'blur'\n    }\n  ],\n  total: [\n    {\n      required: true,\n      message: '请输入成交金额',\n      trigger: 'blur'\n    }\n  ],\n  trans_time: [\n    {\n      required: true,\n      message: '请输入成交日期',\n      trigger: 'blur'\n    }\n  ],\n  flag: [\n    {\n      required: true,\n      message: '请输入成交方式',\n      trigger: 'blur'\n    }\n  ],\n  method: [\n    {\n      required: true,\n      message: '请输入支付方式',\n      trigger: 'blur'\n    }\n  ],\n})\n\nonMounted(async () => {\n  const y = await myOrders(localStorage.getItem('token'))\n  ordersData.value = y\n})\n\nconst orderForm = ref({\n  products: [{\n    product_name: '',\n    product_version: '',\n    quantity: '',\n    price: ''\n    }],\n  note: '',\n  trans_time: '',\n  flag: '',\n  total: '',\n  customer_name: '',\n  method: ''\n})\n\nconst addorder = async () => {\n  var legacy_total = 0\n  for (let product of orderForm.value.products) {\n    legacy_total += product.price * product.quantity\n  }\n  if (eval(legacy_total) !== eval(orderForm.value.total)) {\n    ElMessage({\n      type: 'error',\n      message: '总成交额与所有商品销售额总和不符，请重新检查'\n    })\n    return\n  }\n  addOrder(orderForm.value, localStorage.getItem('token')).then(() => {\n    ElMessageBox.alert('提交成功！', {\n      confirmButtonText: 'OK',\n      callback: () => {\n        setTimeout(initOrderData, 1)\n        setTimeout(resetOrderForm, 1)\n        ElMessage({\n          type: 'info',\n          message: '已更新列表'\n        })\n      }\n    })\n  }).catch((err) => {\n    alert(err)\n  })\n}\n\nconst addOrderProduct = async() =>{\n  orderForm.value.products.push({\n    product_name: '',\n    product_version: '',\n    quantity: '',\n    price: '',\n    key: Date.now()\n  })}\n\nconst removeOrderProduct = (product) => {\n  var index = orderForm.value.products.indexOf(product)\n  if (index !== -1) {\n    orderForm.value.products.splice(index, 1)\n  }\n}\n\nconst resetOrderForm = async() => {\n  orderForm.value = {\n    products: [{\n      product_name: '',\n      product_version: '',\n      quantity: '',\n      price: ''\n    }],\n    note: '',\n    trans_time: '',\n    flag: '',\n    total: '',\n    customer_name: '',\n    method: ''\n  }\n}\nconst ordersData = ref([])\nconst showDialog = ref(false)\nconst dialogData = ref([])\n\nconst handleDetail = async (row) => {\n  // eslint-disable-next-line\n  const x = await orderDetail(row.orderId, localStorage.getItem('token'))\n  showDialog.value = true\n  dialogData.value = x\n}\n\nconst initOrderData = async () => {\n  ordersData.value = []\n  ordersData.value = await myOrders(localStorage.getItem('token'))\n}\n\nconst handleDelete = async (row) => {\n  deleteOrder({\n    token: localStorage.getItem('token'),\n    orderId: row.orderId,\n  })\n  ElMessage({\n    type: 'info',\n    message: '已删除'\n  })\n  setTimeout(initOrderData, 1)\n}\n\nconst focusOnNextItem = (nextItemId) => {\n  var nextItem = document.getElementById(nextItemId)\n  nextItem.focus()\n}\n</script>\n\n<style scoped lang=\"scss\">\n\n.list-form {\n  margin-left: 350px;\n}\n\n.page-title {\n  font-size: 20px;\n  text-align: left;\n  margin-left: 300px;\n  margin-bottom: 20px;\n}\n\n.item-input {\n  width: 400px;\n}\n\n.item-button {\n  margin-left: 10px;\n  margin-top: 20px;\n}\n\n.items-container {\n  margin-left: 300px;\n  width: 1000px;\n}\n\n.page-title {\n  font-size: 20px;\n  text-align: left;\n  margin-left: 300px;\n  margin-bottom: 20px;\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}